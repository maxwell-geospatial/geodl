#' describeBatch
#'
#' Generate summary information about a batch of image chips and masks.
#'
#' The goal of this function is to provide a check of a batch of image chips and associated
#' masks generated by a DataLoader instance using defineSegDataSet(). Summary information includes the batch size
#' (batchSize); image chip data type (imageDataType); mask data type (maskDataType); the shape of each
#' image chip as number of channels, height pixel count, and width pixel count (imageShape); the mask shape
#' (maskShape); image band statistics (imageStats) including mean (mean), median (median), minimum (min),
#' maximum (max), and standard deviation (sd); mask class index statistics (mskStats) including minimum (min)
#' and maximum (max) class indices; and count of pixels in each class in the batch (mskCnts).
#'
#' @param dataLoader Instantiated instance of a DataLoader created using torch::dataloader().
#' @return List object summarizing a batch of image chips and masks.
#' @export
describeBatch <- function(dataLoader){

  batch1 <- dataLoader$.iter()$.next()

  imgDims <- batch1$image$shape %>% as.character()
  mskDims <- batch1$mask$shape %>% as.character()
  imgDT <- batch1$image[1]$dtype %>% as.character()
  mskDT <- batch1$mask[1]$dtype %>% as.character()

  batchI <- batch1$image %>% as.array()
  batchM <- batch1$mask %>% as.array()

  maskDims <- dim(batchM)

  imgStats <- apply(batchI, 2, function(x) c(mean = mean(x), median=median(x), min = min(x), max = max(x), sd=sd(x)))
  mskStats <- apply(batchM, 2, function(x) c( min = min(x), max = max(x)))

  mskCnts <- table(batchM)

  return(list(batchSize = imgDims[1],
              imageDataType = imgDT,
              maskDataType = mskDT,
              imageShape=imgDims[2:4],
              maskShape=mskDims[2:length(maskDims)],
              imageStats= imgStats,
              maskStats=mskStats,
              maskCount=mskCnts
              ))
}
